'use strict';const _0x584699=_0x26b2;(function(_0x2bde9d,_0x922c52){const _0x1f5f21=_0x26b2,_0x6de4cc=_0x2bde9d();while(!![]){try{const _0x58bf48=parseInt(_0x1f5f21(0x13e))/0x1+-parseInt(_0x1f5f21(0x157))/0x2*(parseInt(_0x1f5f21(0x10f))/0x3)+-parseInt(_0x1f5f21(0x11b))/0x4*(-parseInt(_0x1f5f21(0x171))/0x5)+-parseInt(_0x1f5f21(0x121))/0x6*(-parseInt(_0x1f5f21(0x163))/0x7)+parseInt(_0x1f5f21(0x19f))/0x8+-parseInt(_0x1f5f21(0x109))/0x9*(parseInt(_0x1f5f21(0x18c))/0xa)+parseInt(_0x1f5f21(0x113))/0xb*(-parseInt(_0x1f5f21(0x120))/0xc);if(_0x58bf48===_0x922c52)break;else _0x6de4cc['push'](_0x6de4cc['shift']());}catch(_0x3ec5ed){_0x6de4cc['push'](_0x6de4cc['shift']());}}}(_0x304e,0x23138));function _0x26b2(_0x3cd5d0,_0x47d33a){const _0x304eb8=_0x304e();return _0x26b2=function(_0x26b2ce,_0x1a1af4){_0x26b2ce=_0x26b2ce-0xfd;let _0x2b9b3e=_0x304eb8[_0x26b2ce];return _0x2b9b3e;},_0x26b2(_0x3cd5d0,_0x47d33a);}var __decorate=this&&this[_0x584699(0x180)]||function(_0x135d64,_0x2d9004,_0x42f937,_0x9e3d9e){const _0x49e336=_0x584699;var _0x1f38f4=arguments[_0x49e336(0x16d)],_0x4e6775=_0x1f38f4<0x3?_0x2d9004:_0x9e3d9e===null?_0x9e3d9e=Object['getOwnPropertyDescriptor'](_0x2d9004,_0x42f937):_0x9e3d9e,_0x449d2b;if(typeof Reflect===_0x49e336(0x18e)&&typeof Reflect[_0x49e336(0x17e)]===_0x49e336(0x131))_0x4e6775=Reflect[_0x49e336(0x17e)](_0x135d64,_0x2d9004,_0x42f937,_0x9e3d9e);else{for(var _0x42ce33=_0x135d64[_0x49e336(0x16d)]-0x1;_0x42ce33>=0x0;_0x42ce33--)if(_0x449d2b=_0x135d64[_0x42ce33])_0x4e6775=(_0x1f38f4<0x3?_0x449d2b(_0x4e6775):_0x1f38f4>0x3?_0x449d2b(_0x2d9004,_0x42f937,_0x4e6775):_0x449d2b(_0x2d9004,_0x42f937))||_0x4e6775;}return _0x1f38f4>0x3&&_0x4e6775&&Object[_0x49e336(0x110)](_0x2d9004,_0x42f937,_0x4e6775),_0x4e6775;},__metadata=this&&this['__metadata']||function(_0x3a6a24,_0x5691b4){const _0x1ddd86=_0x584699;if(typeof Reflect==='object'&&typeof Reflect[_0x1ddd86(0x19b)]===_0x1ddd86(0x131))return Reflect[_0x1ddd86(0x19b)](_0x3a6a24,_0x5691b4);},__param=this&&this[_0x584699(0x169)]||function(_0x1051eb,_0x245dc6){return function(_0x4b4975,_0x39c473){_0x245dc6(_0x4b4975,_0x39c473,_0x1051eb);};};Object[_0x584699(0x110)](exports,'__esModule',{'value':!![]}),exports[_0x584699(0x164)]=void 0x0;function _0x304e(){const _0x5c1c03=['createRandomUid','verificationService','当前密码错误！','InjectRepository','consecutiveDays','369xuzsWD','forEach','whiteListEntity','qureyUserInfoByInviteCode','inviteLink','getInviteRecord','750768PgwJsd','defineProperty','没有变更，无需更改！','design:paramtypes','2513159ZLygRf','inviteCode','password','map','createUserFromOpenId','Connection','getUserStatus','log','4OoPdjN','connection','getUserById','phone','verifyUserCredentials','12qiSqYu','6uDaFwE','该微信已绑定其他账号！','./user.entity','update','role','updateUserStatus','save','BAD_REQUEST','修改密码失败、请重新试试吧。','./../verification/verification.service','修改用户信息成功！','getUserOpenId','RechargeType','isBindWx','configMap:\x20','../globalConfig/config.entity','function','Like','updateStatus','registerVerifyEmailTitle','affected','../chatgpt/whiteList.entity','sign','reduce','用户名已存在、请更换用户名！','ConfigEntity','当前用户不存在！','findAndCount','error:\x20','138482JYUjLQ','../../common/utils','../../common/constants/balance.constant','已生成过邀请码、请勿重复生成','GlobalConfigService','status','split','绑定微信失败、请联系管理员！','修改用户状态失败！','ADMIN_GIFT','Registration','email','不可将用户置为未激活状态！','find','queryAll','获取邀请记录失败！','当前用户信息失效、请重新登录！','verifyUserRegisterByPhone','hashSync','createUser','mailerService','user','@nestjs/typeorm','用户不存在！','saveRecordRechargeLog','2rzxXeb','compareSync','userEntity','lodash','当前账户不存在！','UNAUTHORIZED','当前绑定用户不存在！','123456','userBalanceService','./../../common/constants/user.constant','MailerService','addBalanceToNewUser','947765ZGCtWe','UserService','Injectable','openId','checkUserStatus','queryUserBalanceByIds','__param','savaLoginIp','resetUserPass','lastLoginIp','length','typeorm','super','UserStatusEnum','1410055nMArZY','无效的邀请码！','assign','findOne','userRecharge','avatar','configEntity','PENDING','@default.com','isVerifyEmail','HttpStatus','queryUserInfoById','超级管理员不可被操作！','decorate','userId','__decorate','../../common/constants/verification.constant','重置密码失败！','生成邀请码失败，请重新试一次吧！','修改用户状态成功！','addBalanceToUser','sendMail','HttpException','当前用户已被加入锁定、请联系管理员解锁！','未激活用户不可手动变更状态！','configKey','getUserFromOpenId','6730YCeQoa','Repository','object','WhiteListEntity','maskIpAddress','registerVerifyEmailFrom','的账号激活','globalConfigService','registerVerifyExpir','queryOne','registerBaseUrl','genInviteCode','用户名已存在！','用户名或者邮箱已被注册！','userDefautlAvatar','metadata',']成功!','BLACKLISTED','configVal','752816pWhOMa','queryUserBalance','getClientIp','UserStatusErrMsg','@nestjs/common','@nestjs-modules/mailer','Not','createdAt','updateInfo','getConfigs','maskEmail','username','./../globalConfig/globalConfig.service','ACTIVE','DESC','createVerification'];_0x304e=function(){return _0x5c1c03;};return _0x304e();}const globalConfig_service_1=require(_0x584699(0x100)),user_constant_1=require(_0x584699(0x160)),mailer_1=require(_0x584699(0x1a4)),verification_service_1=require(_0x584699(0x12a)),common_1=require(_0x584699(0x1a3)),typeorm_1=require(_0x584699(0x154)),typeorm_2=require(_0x584699(0x16e)),user_entity_1=require(_0x584699(0x123)),bcrypt=require('bcryptjs'),_=require(_0x584699(0x15a)),verification_constant_1=require(_0x584699(0x181)),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x584699(0x13f)),balance_constant_1=require(_0x584699(0x140)),config_entity_1=require(_0x584699(0x130)),whiteList_entity_1=require(_0x584699(0x136));let UserService=class UserService{constructor(_0x5cee42,_0x364abf,_0x29b03a,_0x3b8cf9,_0x33d34e,_0x49f340,_0x497920,_0x2294bd){const _0x247943=_0x584699;this[_0x247943(0x159)]=_0x5cee42,this[_0x247943(0x10b)]=_0x364abf,this[_0x247943(0x11c)]=_0x29b03a,this[_0x247943(0x105)]=_0x3b8cf9,this[_0x247943(0x152)]=_0x33d34e,this['userBalanceService']=_0x49f340,this['globalConfigService']=_0x497920,this[_0x247943(0x177)]=_0x2294bd;}async['createUserAndVerifycation'](_0x8693ba,_0x416ade){const _0x5e95c1=_0x584699,{username:_0x5378a8,email:_0x279047,password:_0x2183cb,invitedBy:_0x280aee,client:client=0x0}=_0x8693ba;if(_0x280aee){const _0xb973f9=await this[_0x5e95c1(0x159)][_0x5e95c1(0x174)]({'where':{'inviteCode':_0x280aee}});if(!_0xb973f9)throw new common_1[(_0x5e95c1(0x187))](_0x5e95c1(0x172),common_1[_0x5e95c1(0x17b)][_0x5e95c1(0x128)]);}const _0x30079e=[{'username':_0x5378a8},{'email':_0x279047}],_0x4ae7e9=await this['userEntity']['findOne']({'where':_0x30079e});if(_0x4ae7e9&&_0x4ae7e9[_0x5e95c1(0x143)]!==user_constant_1[_0x5e95c1(0x170)][_0x5e95c1(0x178)])throw new common_1['HttpException'](_0x5e95c1(0x199),common_1[_0x5e95c1(0x17b)][_0x5e95c1(0x128)]);try{const _0x43940d=_['cloneDeep'](_0x8693ba),_0x37c7c2=bcrypt['hashSync'](_0x2183cb,0xa),_0x5f32ba=(0x0,utils_1[_0x5e95c1(0x1a1)])(_0x416ade);_0x43940d[_0x5e95c1(0x115)]=_0x37c7c2,_0x43940d['registerIp']=_0x5f32ba,_0x43940d['client']=client;let _0x582fd5;if(!_0x4ae7e9){const _0x11ad74=await this[_0x5e95c1(0x193)][_0x5e95c1(0xfd)]([_0x5e95c1(0x19a)]);_0x43940d[_0x5e95c1(0x176)]=_0x11ad74,_0x582fd5=await this[_0x5e95c1(0x159)][_0x5e95c1(0x127)](_0x43940d);}else _0x582fd5=_0x4ae7e9;const _0x19f399=await this[_0x5e95c1(0x177)]['find']({'where':{'configKey':(0x0,typeorm_2['In'])(['isVerifyEmail',_0x5e95c1(0x196),_0x5e95c1(0x134),'registerVerifyEmailDesc',_0x5e95c1(0x191),'registerVerifyExpir'])}}),_0x1f30e8=_0x19f399[_0x5e95c1(0x138)]((_0xbf6c52,_0x145618)=>{const _0x592ac3=_0x5e95c1;return _0xbf6c52[_0x145618[_0x592ac3(0x18a)]]=_0x145618[_0x592ac3(0x19e)],_0xbf6c52;},{}),_0x4d8897=_0x1f30e8[_0x5e95c1(0x17a)]?Number(_0x1f30e8[_0x5e95c1(0x17a)]):0x1;if(_0x4d8897){const _0x4ca8aa=_0x1f30e8['registerVerifyExpir']?Number(_0x1f30e8[_0x5e95c1(0x194)]):0x1e*0x3c,_0x45e7d6=await this['verificationService'][_0x5e95c1(0x103)](_0x582fd5,verification_constant_1['VerificationEnum'][_0x5e95c1(0x148)],_0x4ca8aa),{code:_0x5534f4,email:_0x3c669c,id:_0x556216}=_0x45e7d6,{registerVerifyEmailFrom:_0x383ea4}=_0x1f30e8;console[_0x5e95c1(0x11a)](_0x5e95c1(0x12f),_0x1f30e8);const _0x33cb0b=await this['mailerService'][_0x5e95c1(0x186)]({'to':_0x3c669c,'subject':'来自'+_0x383ea4+_0x5e95c1(0x192),'template':'register','context':Object[_0x5e95c1(0x173)]({'baseUrl':_0x1f30e8['registerBaseUrl'],'code':_0x5534f4,'id':_0x556216},_0x1f30e8)});console['log']('email\x20response\x20\x20->\x20:\x20',_0x33cb0b);}else{const {username:_0x29c701,email:_0x3fae4f,id:_0x4fb829,invitedBy:_0xbe3803}=_0x582fd5;await this[_0x5e95c1(0x126)](_0x4fb829,user_constant_1[_0x5e95c1(0x170)][_0x5e95c1(0x101)]);let _0x21eeae;_0xbe3803&&(_0x21eeae=await this[_0x5e95c1(0x10c)](_0xbe3803)),await this['userBalanceService'][_0x5e95c1(0x162)](_0x4fb829,_0x21eeae===null||_0x21eeae===void 0x0?void 0x0:_0x21eeae['id']);}return _0x582fd5;}catch(_0x8b248f){console[_0x5e95c1(0x11a)](_0x5e95c1(0x13d),_0x8b248f);throw _0x8b248f;}}async[_0x584699(0x11f)](_0x469b81){const _0xfdc6c0=_0x584699,{username:_0x4b1e2a,password:_0x1a9433,uid:uid=0x0,phone:_0x2da0a1}=_0x469b81;let _0x47f889=null;if(uid>0x0){_0x47f889=await this[_0xfdc6c0(0x159)][_0xfdc6c0(0x174)]({'where':{'id':uid}});if(!_0x47f889)throw new common_1['HttpException'](_0xfdc6c0(0x15b),common_1[_0xfdc6c0(0x17b)][_0xfdc6c0(0x128)]);if(!bcrypt[_0xfdc6c0(0x158)](_0x1a9433,_0x47f889[_0xfdc6c0(0x115)]))throw new common_1[(_0xfdc6c0(0x187))](_0xfdc6c0(0x106),common_1[_0xfdc6c0(0x17b)][_0xfdc6c0(0x128)]);}if(_0x4b1e2a&&_0x1a9433){const _0x3c2f72=[{'username':_0x4b1e2a},{'email':_0x4b1e2a}];_0x47f889=await this[_0xfdc6c0(0x159)]['findOne']({'where':_0x3c2f72});if(!_0x47f889)throw new common_1[(_0xfdc6c0(0x187))](_0xfdc6c0(0x15b),common_1[_0xfdc6c0(0x17b)][_0xfdc6c0(0x128)]);if(!bcrypt[_0xfdc6c0(0x158)](_0x1a9433,_0x47f889[_0xfdc6c0(0x115)]))throw new common_1[(_0xfdc6c0(0x187))](_0xfdc6c0(0x106),common_1['HttpStatus']['BAD_REQUEST']);}if(_0x2da0a1&&_0x1a9433){const _0xfe500b=[{'phone':_0x2da0a1}];_0x47f889=await this['userEntity']['findOne']({'where':_0xfe500b});if(!_0x47f889)throw new common_1[(_0xfdc6c0(0x187))](_0xfdc6c0(0x15b),common_1[_0xfdc6c0(0x17b)][_0xfdc6c0(0x128)]);if(!bcrypt[_0xfdc6c0(0x158)](_0x1a9433,_0x47f889[_0xfdc6c0(0x115)]))throw new common_1[(_0xfdc6c0(0x187))](_0xfdc6c0(0x106),common_1['HttpStatus']['BAD_REQUEST']);}if(!_0x47f889)throw new common_1[(_0xfdc6c0(0x187))](_0xfdc6c0(0x15b),common_1[_0xfdc6c0(0x17b)][_0xfdc6c0(0x128)]);if(_0x47f889[_0xfdc6c0(0x143)]!==user_constant_1['UserStatusEnum'][_0xfdc6c0(0x101)])throw new common_1['HttpException'](user_constant_1[_0xfdc6c0(0x1a2)][_0x47f889['status']],common_1['HttpStatus'][_0xfdc6c0(0x128)]);return _0x47f889;}async['verifyUserPassword'](_0x588078,_0x2e9e84){const _0x34405f=_0x584699,_0x58f4d9=await this[_0x34405f(0x159)][_0x34405f(0x174)]({'where':{'id':_0x588078}});return bcrypt[_0x34405f(0x158)](_0x2e9e84,_0x58f4d9[_0x34405f(0x115)]);}async[_0x584699(0x126)](_0x37f56b,_0x5885f3){const _0xc5c6ca=_0x584699,_0x34a73d=await this['userEntity'][_0xc5c6ca(0x124)]({'id':_0x37f56b},{'status':_0x5885f3});return _0x34a73d[_0xc5c6ca(0x135)]>0x0;}async[_0x584699(0x119)](_0xda0803){const _0x48dc90=_0x584699,_0x3939e4=await this['userEntity'][_0x48dc90(0x174)]({'where':{'id':_0xda0803}});return _0x3939e4[_0x48dc90(0x143)];}async[_0x584699(0x17c)](_0x4d033a){const _0x57920c=_0x584699;return await this[_0x57920c(0x159)][_0x57920c(0x174)]({'where':{'id':_0x4d033a}});}async['queryOneUserInfo'](_0x5a2f68){const _0xd29c47=_0x584699;return await this[_0xd29c47(0x159)][_0xd29c47(0x174)]({'where':{'id':_0x5a2f68}});}async[_0x584699(0x167)](_0x214628){const _0x35fff2=_0x584699,_0x3e303b=await this[_0x35fff2(0x159)][_0x35fff2(0x174)]({'where':{'id':_0x214628}});if(!_0x3e303b)throw new common_1[(_0x35fff2(0x187))](_0x35fff2(0x14e),common_1[_0x35fff2(0x17b)]['UNAUTHORIZED']);if(_0x3e303b[_0x35fff2(0x143)]===user_constant_1[_0x35fff2(0x170)][_0x35fff2(0x19d)])throw new common_1['HttpException']('当前用户已被加入黑名单、请联系管理员解封！',common_1['HttpStatus'][_0x35fff2(0x128)]);if(_0x3e303b[_0x35fff2(0x143)]===user_constant_1[_0x35fff2(0x170)]['LOCKED'])throw new common_1['HttpException'](_0x35fff2(0x188),common_1[_0x35fff2(0x17b)][_0x35fff2(0x128)]);}async['getUserInfo'](_0x1fddf1){const _0x151908=_0x584699,_0x42f584=await this[_0x151908(0x159)][_0x151908(0x174)]({'where':{'id':_0x1fddf1},'select':[_0x151908(0xff),_0x151908(0x176),_0x151908(0x125),_0x151908(0x149),_0x151908(0x137),_0x151908(0x114),_0x151908(0x166),_0x151908(0x108)]});if(!_0x42f584)throw new common_1['HttpException']('当前用户信息失效、请重新登录！',common_1['HttpStatus'][_0x151908(0x15c)]);_0x42f584[_0x151908(0x12e)]=!!(_0x42f584===null||_0x42f584===void 0x0?void 0x0:_0x42f584[_0x151908(0x166)]),delete _0x42f584[_0x151908(0x166)];const _0x5b43ba=await this[_0x151908(0x15f)][_0x151908(0x1a0)](_0x1fddf1);return{'userInfo':_0x42f584,'userBalance':Object['assign']({},_0x5b43ba)};}async[_0x584699(0x11d)](_0x197c3a){const _0x1d278d=_0x584699;return await this[_0x1d278d(0x159)]['findOne']({'where':{'id':_0x197c3a}});}async[_0x584699(0x12c)](_0x5d4309){const _0x20a477=_0x584699;return await this[_0x20a477(0x159)][_0x20a477(0x174)]({'where':{'openId':_0x5d4309}});}async[_0x584699(0x1a7)](_0x16e157,_0x367eb8){const _0x39760b=_0x584699,{id:_0x210d58}=_0x367eb8['user'],_0x4ade70=await this[_0x39760b(0x159)][_0x39760b(0x174)]({'where':{'id':_0x210d58}});if(!_0x4ade70)throw new common_1['HttpException'](_0x39760b(0x13b),common_1['HttpStatus'][_0x39760b(0x128)]);if(_0x16e157[_0x39760b(0xff)]&&_0x4ade70[_0x39760b(0xff)]===_0x16e157[_0x39760b(0xff)])throw new common_1[(_0x39760b(0x187))](_0x39760b(0x111),common_1[_0x39760b(0x17b)][_0x39760b(0x128)]);if(_0x16e157['username']){const _0x536cc5=await this[_0x39760b(0x159)][_0x39760b(0x174)]({'where':{'username':_0x16e157['username'],'id':(0x0,typeorm_2[_0x39760b(0x1a5)])(_0x210d58)}});if(_0x536cc5)throw new common_1['HttpException'](_0x39760b(0x198),common_1[_0x39760b(0x17b)][_0x39760b(0x128)]);}const _0x11f8b8=await this[_0x39760b(0x159)][_0x39760b(0x124)]({'id':_0x210d58},_0x16e157);if(_0x11f8b8[_0x39760b(0x135)]<=0x0)throw new common_1[(_0x39760b(0x187))]('修改用户信息失败！',common_1[_0x39760b(0x17b)][_0x39760b(0x128)]);return _0x39760b(0x12b);}async['updateUserPassword'](_0x45552f,_0x59b53c){const _0x5bd9ed=_0x584699,_0x44a7b6=bcrypt[_0x5bd9ed(0x150)](_0x59b53c,0xa),_0xfce216=await this['userEntity'][_0x5bd9ed(0x124)]({'id':_0x45552f},{'password':_0x44a7b6});if(_0xfce216['affected']<=0x0)throw new common_1[(_0x5bd9ed(0x187))](_0x5bd9ed(0x129),common_1['HttpStatus'][_0x5bd9ed(0x128)]);}async[_0x584699(0x197)](_0x27ae3){const _0x2537b9=_0x584699,{id:_0x1f1a05}=_0x27ae3['user'],_0x3a1769=await this[_0x2537b9(0x159)][_0x2537b9(0x174)]({'where':{'id':_0x1f1a05}});if(!_0x3a1769||_0x3a1769[_0x2537b9(0x114)])throw new common_1[(_0x2537b9(0x187))](_0x2537b9(0x141),common_1[_0x2537b9(0x17b)]['BAD_REQUEST']);const _0x2b1e85=(0x0,utils_1['generateRandomString'])(),_0xaf3aca=await this[_0x2537b9(0x159)][_0x2537b9(0x174)]({'where':{'inviteCode':_0x2b1e85}});if(_0xaf3aca)throw new common_1[(_0x2537b9(0x187))](_0x2537b9(0x183),common_1[_0x2537b9(0x17b)][_0x2537b9(0x128)]);const _0x3dc6ca=await this['userEntity'][_0x2537b9(0x124)]({'id':_0x1f1a05},{'inviteCode':_0x2b1e85});if(_0x3dc6ca['affected']<=0x0)throw new common_1[(_0x2537b9(0x187))](_0x2537b9(0x183),common_1[_0x2537b9(0x17b)]['BAD_REQUEST']);return _0x2b1e85;}async[_0x584699(0x10e)](_0x1f8ee0,_0x26f1cb){const _0xb96db3=_0x584699;try{const {id:_0x39d8c8}=_0x1f8ee0[_0xb96db3(0x153)],{page:page=0x1,size:size=0xa}=_0x26f1cb,_0x52d10f=await this[_0xb96db3(0x159)]['findOne']({'where':{'id':_0x39d8c8}}),{inviteCode:_0x55f143}=_0x52d10f;if(!_0x55f143)return[];const [_0x18931a,_0x56c126]=await this[_0xb96db3(0x159)][_0xb96db3(0x13c)]({'where':{'inviteCode':_0x55f143},'order':{'id':'DESC'},'select':[_0xb96db3(0xff),_0xb96db3(0x149),_0xb96db3(0x1a6),'status',_0xb96db3(0x176)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1['formatCreateOrUpdateDate'])(_0x18931a)[_0xb96db3(0x116)](_0x17f9ce=>{const _0x35387b=_0xb96db3;return _0x17f9ce['email']=(0x0,utils_1['maskEmail'])(_0x17f9ce[_0x35387b(0x149)]),_0x17f9ce;}),{'rows':_0x18931a,'count':_0x56c126};}catch(_0x4dd15e){console[_0xb96db3(0x11a)](_0xb96db3(0x13d),_0x4dd15e);throw new common_1[(_0xb96db3(0x187))](_0xb96db3(0x14d),common_1['HttpStatus'][_0xb96db3(0x128)]);}}async[_0x584699(0x10d)](_0x1fdb25){const _0x3341a0=_0x584699,_0x4873db=await this[_0x3341a0(0x159)][_0x3341a0(0x174)]({'where':{'inviteCode':_0x1fdb25}});if(!_0x4873db)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x4873db,_0x15b2da=await this[_0x3341a0(0x159)][_0x3341a0(0x124)]({'inviteCode':_0x1fdb25},{'inviteLinkCount':inviteLinkCount+0x1});return _0x15b2da[_0x3341a0(0x135)]?0x1:0x0;}async[_0x584699(0x10c)](_0x144989){const _0x1a8f71=_0x584699;return await this['userEntity'][_0x1a8f71(0x174)]({'where':{'inviteCode':_0x144989}});}async[_0x584699(0x175)](_0x2e67df){const _0x51fa92=_0x584699,{userId:_0x55093f,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x2e67df;await this[_0x51fa92(0x15f)][_0x51fa92(0x185)](_0x55093f,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x1ce0ec=await this['userBalanceService'][_0x51fa92(0x156)]({'userId':_0x55093f,'rechargeType':balance_constant_1[_0x51fa92(0x12d)][_0x51fa92(0x147)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x1ce0ec;}async[_0x584699(0x14c)](_0x2ef42b,_0x3f7039){const _0x1b3af6=_0x584699,{page:page=0x1,size:size=0xa,username:_0x2c53cd,email:_0x21b9f6,status:_0x26be38,keyword:_0x326746}=_0x2ef42b;let _0x2f7234={};_0x2c53cd&&Object[_0x1b3af6(0x173)](_0x2f7234,{'username':(0x0,typeorm_2[_0x1b3af6(0x132)])('%'+_0x2c53cd+'%')}),_0x21b9f6&&Object[_0x1b3af6(0x173)](_0x2f7234,{'email':(0x0,typeorm_2[_0x1b3af6(0x132)])('%'+_0x21b9f6+'%')}),_0x26be38&&Object[_0x1b3af6(0x173)](_0x2f7234,{'status':_0x26be38});_0x326746&&(_0x2f7234=[{'username':(0x0,typeorm_2['Like'])('%'+_0x326746+'%')},{'email':(0x0,typeorm_2[_0x1b3af6(0x132)])('%'+_0x326746+'%')},{'phone':(0x0,typeorm_2[_0x1b3af6(0x132)])('%'+_0x326746+'%')}]);const [_0x2e9f09,_0x2eecb9]=await this[_0x1b3af6(0x159)][_0x1b3af6(0x13c)]({'skip':(page-0x1)*size,'where':_0x2f7234,'take':size,'order':{'createdAt':_0x1b3af6(0x102)},'cache':!![],'select':[_0x1b3af6(0xff),_0x1b3af6(0x176),_0x1b3af6(0x114),'role',_0x1b3af6(0x137),_0x1b3af6(0x143),'id','email','createdAt',_0x1b3af6(0x16c)]}),_0x4f9dfe=_0x2e9f09[_0x1b3af6(0x116)](_0x417e4c=>_0x417e4c['id']),_0x47818d=await this[_0x1b3af6(0x15f)][_0x1b3af6(0x168)](_0x4f9dfe);return _0x2e9f09[_0x1b3af6(0x10a)](_0x3ca0cf=>_0x3ca0cf['balanceInfo']=_0x47818d[_0x1b3af6(0x14b)](_0x53e985=>_0x53e985[_0x1b3af6(0x17f)]===_0x3ca0cf['id'])),_0x3f7039[_0x1b3af6(0x153)][_0x1b3af6(0x125)]!=='super'&&_0x2e9f09['forEach'](_0x1a2ab3=>_0x1a2ab3[_0x1b3af6(0x149)]=(0x0,utils_1[_0x1b3af6(0xfe)])(_0x1a2ab3[_0x1b3af6(0x149)])),_0x3f7039[_0x1b3af6(0x153)][_0x1b3af6(0x125)]!=='super'&&_0x2e9f09[_0x1b3af6(0x10a)](_0x1cecc8=>_0x1cecc8[_0x1b3af6(0x16c)]=(0x0,utils_1[_0x1b3af6(0x190)])(_0x1cecc8[_0x1b3af6(0x16c)])),{'rows':_0x2e9f09,'count':_0x2eecb9};}async[_0x584699(0x195)]({id:_0x482b99}){const _0x2e7895=_0x584699;return await this[_0x2e7895(0x159)][_0x2e7895(0x174)]({'where':{'id':_0x482b99},'select':[_0x2e7895(0xff),_0x2e7895(0x176),_0x2e7895(0x114),'role',_0x2e7895(0x137),_0x2e7895(0x143)]});}async[_0x584699(0x133)](_0x1253bb){const _0x326460=_0x584699,{id:_0x552347,status:_0x103658}=_0x1253bb,_0x54b381=await this[_0x326460(0x159)]['findOne']({'where':{'id':_0x552347}});if(!_0x54b381)throw new common_1[(_0x326460(0x187))](_0x326460(0x155),common_1[_0x326460(0x17b)]['BAD_REQUEST']);if(_0x54b381[_0x326460(0x143)]===user_constant_1['UserStatusEnum'][_0x326460(0x178)])throw new common_1[(_0x326460(0x187))](_0x326460(0x189),common_1[_0x326460(0x17b)]['BAD_REQUEST']);if(_0x54b381[_0x326460(0x125)]===_0x326460(0x16f))throw new common_1[(_0x326460(0x187))](_0x326460(0x17d),common_1[_0x326460(0x17b)][_0x326460(0x128)]);if(_0x103658===user_constant_1[_0x326460(0x170)][_0x326460(0x178)])throw new common_1[(_0x326460(0x187))](_0x326460(0x14a),common_1[_0x326460(0x17b)][_0x326460(0x128)]);const _0x48dabc=await this[_0x326460(0x159)]['update']({'id':_0x552347},{'status':_0x103658});if(_0x48dabc[_0x326460(0x135)]<=0x0)throw new common_1[(_0x326460(0x187))](_0x326460(0x146),common_1['HttpStatus'][_0x326460(0x128)]);return _0x326460(0x184);}async[_0x584699(0x16b)](_0x357629){const _0x1a5a4c=_0x584699,{id:_0x5239e1}=_0x357629,_0x415bd5=await this['userEntity'][_0x1a5a4c(0x174)]({'where':{'id':_0x5239e1}});if(!_0x415bd5)throw new common_1[(_0x1a5a4c(0x187))](_0x1a5a4c(0x155),common_1['HttpStatus'][_0x1a5a4c(0x128)]);const _0x48cc6b=_0x1a5a4c(0x15e),_0x2cedbf=bcrypt[_0x1a5a4c(0x150)](_0x48cc6b,0xa),_0x5d67e2=await this[_0x1a5a4c(0x159)][_0x1a5a4c(0x124)]({'id':_0x5239e1},{'password':_0x2cedbf});if(_0x5d67e2[_0x1a5a4c(0x135)]<=0x0)throw new common_1[(_0x1a5a4c(0x187))](_0x1a5a4c(0x182),common_1['HttpStatus'][_0x1a5a4c(0x128)]);return'密码重置为['+_0x48cc6b+_0x1a5a4c(0x19c);}async[_0x584699(0x16a)](_0x2f3627,_0xc52b3b){const _0x438936=_0x584699;return await this[_0x438936(0x159)][_0x438936(0x124)]({'id':_0x2f3627},{'lastLoginIp':_0xc52b3b});}async[_0x584699(0x18b)](_0x3e7ce2,_0x541a21){const _0x342ece=_0x584699,_0x39ed1e=await this[_0x342ece(0x159)][_0x342ece(0x174)]({'where':{'openId':_0x3e7ce2}});if(!_0x39ed1e){const _0x13d630=_0x541a21?_0x541a21[_0x342ece(0x144)](':')[0x1]:'',_0x40b975=await this[_0x342ece(0x10c)](_0x13d630),_0x4b9c7f=await this[_0x342ece(0x117)](_0x3e7ce2,_0x13d630);return await this[_0x342ece(0x15f)]['addBalanceToNewUser'](_0x4b9c7f['id'],_0x13d630?_0x40b975===null||_0x40b975===void 0x0?void 0x0:_0x40b975['id']:null),_0x4b9c7f;}return _0x39ed1e;}async['createUserFromOpenId'](_0x3cfbef,_0x5dbbd8){const _0xc71a74=_0x584699,_0x8ddbed=await this[_0xc71a74(0x193)][_0xc71a74(0xfd)]([_0xc71a74(0x19a)]),_0x1c34ea={'avatar':_0x8ddbed,'username':'用户'+(0x0,utils_1[_0xc71a74(0x104)])(),'status':user_constant_1['UserStatusEnum']['ACTIVE'],'sex':0x0,'email':(0x0,utils_1[_0xc71a74(0x104)])()+_0xc71a74(0x179),'invitedBy':_0x5dbbd8,'openId':_0x3cfbef},_0x1ec9a0=await this[_0xc71a74(0x159)][_0xc71a74(0x127)](_0x1c34ea);return _0x1ec9a0;}async['bindWx'](_0x3a6ba2,_0x2d7858){const _0x115974=_0x584699;try{const _0x29d54e=await this[_0x115974(0x159)][_0x115974(0x174)]({'where':{'id':_0x2d7858}});if(!_0x29d54e)return{'status':![],'msg':_0x115974(0x15d)};const _0x3d9255=await this['userEntity'][_0x115974(0x174)]({'where':{'openId':_0x3a6ba2}});if(_0x3d9255)return{'status':![],'msg':_0x115974(0x122)};const _0x4205f6=await this[_0x115974(0x159)][_0x115974(0x124)]({'id':_0x2d7858},{'openId':_0x3a6ba2});if(_0x4205f6[_0x115974(0x135)]<=0x0)return{'status':![],'msg':'绑定微信失败、请联系管理员！'};return{'status':!![],'msg':'恭喜您绑定成功、后续可直接扫码登录了！'};}catch(_0x1a961c){return{'status':![],'msg':_0x115974(0x145)};}}async['getOpenIdByUserId'](_0x5d54d7){const _0x16e413=_0x584699,_0xf9d69=await this['userEntity'][_0x16e413(0x174)]({'where':{'id':_0x5d54d7}});return _0xf9d69===null||_0xf9d69===void 0x0?void 0x0:_0xf9d69[_0x16e413(0x166)];}async[_0x584699(0x14f)](_0x14444a){const _0x118de8=_0x584699,{username:_0x385c77,password:_0xb40450,phone:_0x208f0f,phoneCode:_0x3cc018}=_0x14444a,_0x5a2064=await this[_0x118de8(0x159)][_0x118de8(0x174)]({'where':[{'username':_0x385c77},{'phone':_0x208f0f}]});if(_0x5a2064&&_0x5a2064[_0x118de8(0xff)]===_0x385c77)throw new common_1['HttpException'](_0x118de8(0x139),common_1[_0x118de8(0x17b)][_0x118de8(0x128)]);if(_0x5a2064&&_0x5a2064[_0x118de8(0x11e)]===_0x208f0f)throw new common_1[(_0x118de8(0x187))]('当前手机号已注册、请勿重复注册！',common_1['HttpStatus'][_0x118de8(0x128)]);}async[_0x584699(0x151)](_0x457e0f){const _0x247ead=_0x584699;return await this[_0x247ead(0x159)][_0x247ead(0x127)](_0x457e0f);}};UserService=__decorate([(0x0,common_1[_0x584699(0x165)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__param(0x1,(0x0,typeorm_1[_0x584699(0x107)])(whiteList_entity_1[_0x584699(0x18f)])),__param(0x7,(0x0,typeorm_1[_0x584699(0x107)])(config_entity_1[_0x584699(0x13a)])),__metadata(_0x584699(0x112),[typeorm_2['Repository'],typeorm_2[_0x584699(0x18d)],typeorm_2[_0x584699(0x118)],verification_service_1['VerificationService'],mailer_1[_0x584699(0x161)],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x584699(0x142)],typeorm_2[_0x584699(0x18d)]])],UserService),exports[_0x584699(0x164)]=UserService;