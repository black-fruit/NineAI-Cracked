'use strict';function _0x27a3(){const _0x17f926=['design:paramtypes','decorate','昨天签到了、今天是连续签到！','sign','21aAklpo','user','__esModule','InjectRepository','9rwuzku','userEntity','../../common/constants/balance.constant','./signIn.entity','35431QezuSA','addBalanceToUser','SIGN_IN','用户不存在','今日已签到、改天再来吧!.','signin.signInTime\x20>=\x20:firstDay','Sign\x20in\x20successful.','default','saveRecordRechargeLog','format','endOf','6fueRQb','signin.userId\x20=\x20:userId','log','signInDate','338638XaNeAI','signinEntity','month','length','Injectable','findOne','typeorm','getDate','UserBalanceService','defineProperty','save','find','andWhere','HttpStatus','./../userBalance/userBalance.service','getSignatureGiftConfig','globalConfigService','Logger','setDate','./../globalConfig/globalConfig.service','userBalanceService','YYYY-MM-DD\x20HH:mm:ss','../../common/utils/date','day','1690SpiXce','BAD_REQUEST','SigninService','昨天没签到、今天重置天数！','1201386pTCJIN','3518056TsIBgM','isSigned','@nestjs/typeorm','__metadata','GlobalConfigService','565358JEqnFJ','push','getRawMany','function','update','Repository','HttpException','__decorate','object','debug','error:\x20','select','219992kPcQaZ','699185lOsvpu','UserEntity'];_0x27a3=function(){return _0x17f926;};return _0x27a3();}const _0x6d4890=_0x350f;(function(_0x26009e,_0x2fac29){const _0x5866fa=_0x350f,_0x159097=_0x26009e();while(!![]){try{const _0x5da041=-parseInt(_0x5866fa(0x176))/0x1+parseInt(_0x5866fa(0x14c))/0x2*(parseInt(_0x5866fa(0x172))/0x3)+-parseInt(_0x5866fa(0x158))/0x4+-parseInt(_0x5866fa(0x159))/0x5+-parseInt(_0x5866fa(0x146))/0x6*(-parseInt(_0x5866fa(0x15f))/0x7)+parseInt(_0x5866fa(0x147))/0x8*(parseInt(_0x5866fa(0x163))/0x9)+-parseInt(_0x5866fa(0x142))/0xa*(parseInt(_0x5866fa(0x167))/0xb);if(_0x5da041===_0x2fac29)break;else _0x159097['push'](_0x159097['shift']());}catch(_0x379829){_0x159097['push'](_0x159097['shift']());}}}(_0x27a3,0x80e72));var __decorate=this&&this[_0x6d4890(0x153)]||function(_0x1f1031,_0x33eec0,_0x4054b7,_0x3e7716){const _0x4efc9a=_0x6d4890;var _0x184ead=arguments[_0x4efc9a(0x179)],_0x356b79=_0x184ead<0x3?_0x33eec0:_0x3e7716===null?_0x3e7716=Object['getOwnPropertyDescriptor'](_0x33eec0,_0x4054b7):_0x3e7716,_0x21d2dd;if(typeof Reflect===_0x4efc9a(0x154)&&typeof Reflect[_0x4efc9a(0x15c)]===_0x4efc9a(0x14f))_0x356b79=Reflect[_0x4efc9a(0x15c)](_0x1f1031,_0x33eec0,_0x4054b7,_0x3e7716);else{for(var _0x28313a=_0x1f1031['length']-0x1;_0x28313a>=0x0;_0x28313a--)if(_0x21d2dd=_0x1f1031[_0x28313a])_0x356b79=(_0x184ead<0x3?_0x21d2dd(_0x356b79):_0x184ead>0x3?_0x21d2dd(_0x33eec0,_0x4054b7,_0x356b79):_0x21d2dd(_0x33eec0,_0x4054b7))||_0x356b79;}return _0x184ead>0x3&&_0x356b79&&Object[_0x4efc9a(0x133)](_0x33eec0,_0x4054b7,_0x356b79),_0x356b79;},__metadata=this&&this[_0x6d4890(0x14a)]||function(_0xef584a,_0x15ff2b){const _0x2ca943=_0x6d4890;if(typeof Reflect===_0x2ca943(0x154)&&typeof Reflect['metadata']===_0x2ca943(0x14f))return Reflect['metadata'](_0xef584a,_0x15ff2b);},__param=this&&this['__param']||function(_0x191257,_0x931259){return function(_0x32b40e,_0x51cfa9){_0x931259(_0x32b40e,_0x51cfa9,_0x191257);};};Object[_0x6d4890(0x133)](exports,_0x6d4890(0x161),{'value':!![]}),exports[_0x6d4890(0x144)]=void 0x0;const globalConfig_service_1=require(_0x6d4890(0x13d)),userBalance_service_1=require(_0x6d4890(0x138)),common_1=require('@nestjs/common'),signIn_entity_1=require(_0x6d4890(0x166)),typeorm_1=require(_0x6d4890(0x149)),typeorm_2=require(_0x6d4890(0x130)),date_1=require(_0x6d4890(0x140)),user_entity_1=require('../user/user.entity'),balance_constant_1=require(_0x6d4890(0x165));function _0x350f(_0x506c34,_0x19e007){const _0x27a33d=_0x27a3();return _0x350f=function(_0x350fbc,_0x235035){_0x350fbc=_0x350fbc-0x130;let _0x38d6dd=_0x27a33d[_0x350fbc];return _0x38d6dd;},_0x350f(_0x506c34,_0x19e007);}let SigninService=class SigninService{constructor(_0x5aab43,_0x2c68d6,_0x3f7a86,_0x328583){const _0xc4c13b=_0x6d4890;this['signinEntity']=_0x5aab43,this[_0xc4c13b(0x164)]=_0x2c68d6,this[_0xc4c13b(0x13e)]=_0x3f7a86,this[_0xc4c13b(0x13a)]=_0x328583;}async[_0x6d4890(0x15e)](_0x59efbd){const _0x1c0928=_0x6d4890,{id:_0x4f4eb0}=_0x59efbd[_0x1c0928(0x160)],_0x2b5071=(0x0,date_1['default'])(new Date())['format']('YYYY-MM-DD'),_0x3935d4=await this[_0x1c0928(0x177)][_0x1c0928(0x17b)]({'where':{'userId':_0x4f4eb0,'signInDate':_0x2b5071}});if(_0x3935d4)throw new common_1[(_0x1c0928(0x152))](_0x1c0928(0x16b),common_1[_0x1c0928(0x137)][_0x1c0928(0x143)]);const {model3Count:_0x792de8,model4Count:_0x40d9b6,drawMjCount:_0x5dd8ad}=await this[_0x1c0928(0x13a)][_0x1c0928(0x139)]();await this['signinEntity'][_0x1c0928(0x134)]({'userId':_0x4f4eb0,'signInTime':new Date(),'signInDate':_0x2b5071,'isSigned':!![]}),await this[_0x1c0928(0x13e)][_0x1c0928(0x168)](_0x4f4eb0,{'model3Count':_0x792de8,'model4Count':_0x40d9b6,'drawMjCount':_0x5dd8ad}),await this[_0x1c0928(0x13e)][_0x1c0928(0x16f)]({'userId':_0x4f4eb0,'rechargeType':balance_constant_1['RechargeType'][_0x1c0928(0x169)],'model3Count':_0x792de8,'model4Count':_0x40d9b6,'drawMjCount':_0x5dd8ad});const _0x2a7777=(0x0,date_1[_0x1c0928(0x16e)])(new Date())['subtract'](0x1,_0x1c0928(0x141))[_0x1c0928(0x170)]('YYYY-MM-DD'),_0x34ecc6=await this[_0x1c0928(0x177)][_0x1c0928(0x17b)]({'where':{'userId':_0x4f4eb0,'signInDate':_0x2a7777}});if(_0x34ecc6){common_1[_0x1c0928(0x13b)][_0x1c0928(0x155)]('用户'+_0x4f4eb0+_0x1c0928(0x15d),'SigninService');const _0x2300d4=await this['userEntity'][_0x1c0928(0x17b)]({'where':{'id':_0x4f4eb0}});if(!_0x2300d4)throw new common_1[(_0x1c0928(0x152))](_0x1c0928(0x16a),common_1[_0x1c0928(0x137)][_0x1c0928(0x143)]);const {consecutiveDays:consecutiveDays=0x0}=_0x2300d4;await this[_0x1c0928(0x164)]['update']({'id':_0x4f4eb0},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x1c0928(0x13b)][_0x1c0928(0x155)]('用户'+_0x4f4eb0+_0x1c0928(0x145),'SigninService'),await this[_0x1c0928(0x164)][_0x1c0928(0x150)]({'id':_0x4f4eb0},{'consecutiveDays':0x1});return _0x1c0928(0x16d);}async['getSigninLog'](_0x5668cd){const _0x58a1a4=_0x6d4890;try{const {id:_0x2d7044}=_0x5668cd[_0x58a1a4(0x160)],_0xc95c86=(0x0,date_1['default'])()['startOf'](_0x58a1a4(0x178))['format']('YYYY-MM-DD\x20HH:mm:ss'),_0x5078f6=(0x0,date_1['default'])()[_0x58a1a4(0x171)](_0x58a1a4(0x178))[_0x58a1a4(0x170)](_0x58a1a4(0x13f)),_0xc0c736=this['signinEntity']['createQueryBuilder']('signin'),_0x27d922=await _0xc0c736[_0x58a1a4(0x157)]('signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned')['andWhere'](_0x58a1a4(0x173),{'userId':_0x5668cd[_0x58a1a4(0x160)]['id']})[_0x58a1a4(0x136)](_0x58a1a4(0x16c),{'firstDay':_0xc95c86})[_0x58a1a4(0x136)]('signin.signInTime\x20<=\x20:lastDay',{'lastDay':_0x5078f6})[_0x58a1a4(0x14e)](),_0x4c7e0e=new Date(_0xc95c86),_0x5482b1=new Date(_0x5078f6),_0x2b80de=[],_0x55bfe2=new Date(_0x4c7e0e);while(_0x55bfe2<=_0x5482b1){_0x2b80de[_0x58a1a4(0x14d)]((0x0,date_1[_0x58a1a4(0x16e)])(new Date(_0x55bfe2))[_0x58a1a4(0x170)]('YYYY-MM-DD')),_0x55bfe2[_0x58a1a4(0x13c)](_0x55bfe2[_0x58a1a4(0x131)]()+0x1);}const _0x53f2aa=[];for(const _0x2215fb of _0x2b80de){const _0x3909c7=_0x27d922[_0x58a1a4(0x135)](_0x2c133c=>_0x2c133c[_0x58a1a4(0x175)]===_0x2215fb);!_0x3909c7?_0x53f2aa[_0x58a1a4(0x14d)]({'signInDate':_0x2215fb,'isSigned':![]}):(_0x3909c7[_0x58a1a4(0x148)]=!![],_0x53f2aa[_0x58a1a4(0x14d)](_0x3909c7));}return _0x53f2aa;}catch(_0x5410eb){console[_0x58a1a4(0x174)](_0x58a1a4(0x156),_0x5410eb);throw new common_1['HttpException']('获取签到数据失败！',common_1[_0x58a1a4(0x137)][_0x58a1a4(0x143)]);}}};SigninService=__decorate([(0x0,common_1[_0x6d4890(0x17a)])(),__param(0x0,(0x0,typeorm_1[_0x6d4890(0x162)])(signIn_entity_1['SigninEntity'])),__param(0x1,(0x0,typeorm_1[_0x6d4890(0x162)])(user_entity_1[_0x6d4890(0x15a)])),__metadata(_0x6d4890(0x15b),[typeorm_2['Repository'],typeorm_2[_0x6d4890(0x151)],userBalance_service_1[_0x6d4890(0x132)],globalConfig_service_1[_0x6d4890(0x14b)]])],SigninService),exports[_0x6d4890(0x144)]=SigninService;