import{a6 as Z,d as j,r as S,aa as ee,bo as te,aq as O,o as n,c as u,a as i,q as $,t as N,j as e,F as U,l as se,i as l,_ as h,H as B,p as W,v,k as A,A as oe,y as H,M as J,au as le,z as Q,e as w,w as z,f as ae,ar as ne,u as ie,b as re,O as ce,E as L,n as V,af as ue,bp as de}from"./index-12f140ef.js";import{N as pe}from"./Popconfirm-3f56fda0.js";import{N as F}from"./NumberAnimation-cab52b6e.js";import{N as fe}from"./LayoutSider-129a95e0.js";const he=Object.assign(Object.assign({},Z.props),{trigger:String,xScrollable:Boolean,onScroll:Function}),ye=j({name:"Scrollbar",props:he,setup(){const C=S(null);return Object.assign(Object.assign({},{scrollTo:(...d)=>{var r;(r=C.value)===null||r===void 0||r.scrollTo(d[0],d[1])},scrollBy:(...d)=>{var r;(r=C.value)===null||r===void 0||r.scrollBy(d[0],d[1])}}),{scrollbarInstRef:C})},render(){return ee(te,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),me=ye;function _e(C,p){let d;return(...r)=>{const f=()=>{clearTimeout(d),C(...r)};clearTimeout(d),d=setTimeout(f,p)}}const ve={class:"mb-2 text-xs text-neutral-400 font-bold"},ke={class:"ml-1"},be=["onClick"],ge={class:"relative flex-1 overflow-hidden break-all text-ellipsis whitespace-nowrap"},xe={key:1},Se={key:0,class:"absolute z-10 flex visible right-1"},we=["onClick"],Ce={class:"p-1"},Ie={key:0,class:"p-1"},$e={class:"p-1"},P=j({__name:"ListItem",props:{dataSources:null,title:null},emits:["update","delete","sticky","select"],setup(C,{emit:p}){const d=C,r=d.dataSources,f=O();async function m(o){p("select",o)}function _(o,s,c){c==null||c.stopPropagation(),o.isEdit=s}async function k(o,s){s==null||s.stopPropagation(),await f.updateGroupInfo({isSticky:!o.isSticky,groupId:o.uuid}),await f.queryMyGroup()}async function y(o,s){s==null||s.stopPropagation(),p("delete",o)}const D=_e(y,600);async function b(o){const{uuid:s,title:c}=o;o.isEdit=!1,await f.updateGroupInfo({groupId:s,title:c}),await f.queryMyGroup()}async function G(o,s){s==null||s.stopPropagation(),s.key==="Enter"&&b(o)}function M(o,s){s==null||s.stopPropagation(),b(o)}function T(o){return f.active===o}return(o,s)=>{var c;return n(),u(U,null,[i("p",ve,[$(N(d.title)+" ",1),i("span",ke,"("+N((c=e(r))==null?void 0:c.length)+")",1)]),(n(!0),u(U,null,se(e(r),a=>(n(),u("div",{key:`${a.uuid}`},[i("a",{class:oe(["relative flex items-center gap-3 px-3 py-2 break-all border rounded-md cursor-pointer hover:bg-neutral-100 group dark:border-neutral-800 dark:hover:bg-[#24272e]",T(a.uuid)&&["border-[#3076FD]","bg-neutral-100","text-[#3076FD]","dark:bg-[#24272e]","dark:border-[#4b9e5f]","pr-20"]]),onClick:t=>m(a)},[i("span",null,[l(e(h),{icon:a.isSticky?"ri:pushpin-2-line":a.appId?"icon-park-outline:application-one":"ri:message-3-line"},null,8,["icon"])]),i("div",ge,[a.isEdit?(n(),B(e(W),{key:0,value:a.title,"onUpdate:value":t=>a.title=t,size:"tiny",onKeypress:t=>G(a,t)},null,8,["value","onUpdate:value","onKeypress"])):(n(),u("span",xe,N(a.title),1))]),T(a.uuid)?(n(),u("div",Se,[a.isEdit?(n(),u("button",{key:0,class:"p-1",onClick:t=>M(a,t)},[l(e(h),{icon:"ri:save-line"})],8,we)):(n(),u(U,{key:1},[i("button",Ce,[l(e(h),{icon:a.isSticky?"ri:unpin-line":"ri:pushpin-line",onClick:t=>k(a,t)},null,8,["icon","onClick"])]),a.appId?v("",!0):(n(),u("button",Ie,[l(e(h),{icon:"ri:edit-line",onClick:t=>_(a,!0,t)},null,8,["onClick"])])),l(e(pe),{placement:"bottom",onPositiveClick:t=>e(D)(a,t)},{trigger:A(()=>[i("button",$e,[l(e(h),{icon:"ri:delete-bin-line"})])]),default:A(()=>[$(" "+N(o.$t("chat.deleteHistoryConfirm")),1)]),_:2},1032,["onPositiveClick"])],64))])):v("",!0)],10,be)]))),128))],64)}}}),De={class:"flex flex-col gap-2 text-sm"},Te={key:0,class:"flex flex-col items-center mt-4 text-center text-neutral-300"},Ae=j({__name:"List",setup(C){const{isMobile:p}=H(),d=J(),r=le(),f=Q(),m=O(),_=S(100),k=w(()=>m.groupList),y=w(()=>m.groupKeyWord);z(k,()=>_.value=_.value+1),z(y,()=>_.value=_.value+1);function D(t){const R=new Date(t).getTime()+8*60*60*1e3;return new Date(R).getTime()}const b=new Date().setHours(0,0,0,0),G=w(()=>k.value.filter(t=>y.value?t.title.includes(y.value)&&t.isSticky:t.isSticky)),M=w(()=>k.value.filter(t=>y.value?t.title.includes(y.value)&&!t.isSticky&&t.appId:!t.isSticky&&t.appId)),T=w(()=>k.value.filter(t=>y.value?t.title.includes(y.value)&&!t.isSticky&&!t.appId&&D(t.createdAt)>=b:!t.isSticky&&!t.appId&&D(t.createdAt)>=b)),o=w(()=>k.value.filter(t=>y.value?t.title.includes(y.value)&&!t.isSticky&&!t.appId&&D(t.createdAt)<b:!t.isSticky&&!t.appId&&D(t.createdAt)<b));async function s({uuid:t}){a(t)||(await m.setActiveGroup(t),r.name!=="Chat"&&d.push("/chat"),p.value&&f.setSiderCollapsed(!0))}async function c(t){event==null||event.stopPropagation(),await m.deleteGroup(t),await m.queryMyGroup(),p.value&&f.setSiderCollapsed(!0)}function a(t){return m.active===t}return ae(()=>{m.queryMyGroup()}),(t,E)=>(n(),B(e(me),{class:"px-4"},{default:A(()=>[i("div",De,[e(k).length?(n(),u(U,{key:1},[e(G).length?(n(),B(P,{key:1e3+_.value,title:"置顶","data-sources":e(G),onSelect:s,onDelete:c},null,8,["data-sources"])):v("",!0),e(M).length?(n(),B(P,{key:2e3+_.value,title:"应用对话组","data-sources":e(M),onSelect:s,onDelete:c},null,8,["data-sources"])):v("",!0),e(T).length?(n(),B(P,{key:3e3+_.value,title:"今天","data-sources":e(T),onSelect:s,onDelete:c},null,8,["data-sources"])):v("",!0),e(o).length?(n(),B(P,{key:4e3+_.value,title:"其他","data-sources":e(o),onSelect:s,onDelete:c},null,8,["data-sources"])):v("",!0)],64)):(n(),u("div",Te,[l(e(h),{icon:"ri:inbox-line",class:"mb-2 text-3xl"}),i("span",null,N(t.$t("common.noData")),1)]))])]),_:1}))}}),Ge={class:"flex flex-col h-full flex-1 min-h-0"},Me={class:"flex h-14 items-center space-x-2 bg-white px-4 dark:bg-[#18181c]"},Ne={class:"flex-1"},Be={class:"flex-1 min-h-0 pb-4 overflow-hidden"},ze={key:0,class:"px-6 py-2 flex items-center border-t dark:border-t-neutral-800"},Le={class:"p-4 border-t dark:border-t-neutral-800 flex flex-col"},Pe={key:0,class:"my-1 flex items-center select-none"},Ue={key:1,class:"my-1 flex items-center select-none"},je={key:2,class:"my-1 flex items-center select-none"},Ee={key:3,class:"my-1 flex items-center select-none"},Re={class:"flex justify-between my-3"},Oe=i("span",{class:"mr-2"},"公告栏",-1),qe=i("span",{class:"mr-3"},"个人仓库",-1),Ke={class:"flex justify-betweenx"},Ve=i("span",{class:"mr-3"},"清空全部非置顶会话",-1),Qe=j({__name:"index",setup(C){const p=ne(),d=J(),r=Q(),f=O(),m=ie();re();const _=S(null),k=S(null),y=w(()=>m.userBalance),D=ce(),b=S(0),G=S(0),M=S(0),T=S(0);z(()=>m.userBalance.useModel3Token,(g,x)=>{var I;b.value=x||0,G.value=g||0,(I=_.value)==null||I.play()},{immediate:!0,flush:"post"}),z(()=>m.userBalance.useModel4Token,(g,x)=>{var I;M.value=x||0,T.value=g||0,(I=k.value)==null||I.play()},{immediate:!0,flush:"post"});const{isMobile:o}=H(),s=S(!1),c=w(()=>r.siderCollapsed),a=S("");function t(g){a.value=g,f.setGroupKeyWord(g)}function E(){d.push("/role")}async function R(){try{s.value=!0,await f.addNewChatGroup(),await f.queryMyGroup(),s.value=!1,o.value&&r.setSiderCollapsed(!0)}catch{s.value=!1}}async function q(){D.warning({title:"清空分组",content:"是否删除所有非置顶的对话组？",positiveText:"确认删除",negativeText:"再想想",onPositiveClick:async()=>{await f.delAllGroup()}})}function K(){r.setSiderCollapsed(!c.value)}const X=w(()=>o.value?{position:"fixed",zIndex:50}:{}),Y=w(()=>o.value?{paddingBottom:"env(safe-area-inset-bottom)"}:{});return z(o,g=>{r.setSiderCollapsed(g)},{immediate:!0,flush:"post"}),(g,x)=>(n(),u("div",null,[l(e(fe),{collapsed:e(c),"collapsed-width":0,width:260,"show-trigger":e(o)?!1:"arrow-circle","collapse-mode":"transform",position:"absolute",bordered:"",style:V(e(X)),onUpdateCollapsed:K},{default:A(()=>[i("div",{class:"flex flex-col h-full",style:V(e(Y))},[i("main",Ge,[i("div",Me,[i("div",Ne,[l(e(W),{modelValue:a.value,"onUpdate:modelValue":x[0]||(x[0]=I=>a.value=I),type:"text",placeholder:"对话历史查找",clearable:"",size:"small",onInput:t},null,8,["modelValue"])]),l(e(L),{type:"info",size:"small",loading:s.value,onClick:R},{default:A(()=>[l(e(h),{icon:"ion:add-outline",class:"text-xl"})]),_:1},8,["loading"])]),i("div",Be,[l(Ae)]),e(o)?v("",!0):(n(),u("div",ze,[i("div",{class:"flex items-center w-full p-1 mb-1 text-[#3076fd] rounded cursor-pointer transition hover:bg-[#eef0f3] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:x[1]||(x[1]=I=>e(p).updateGoodsDialog(!0))},[l(e(h),{icon:"material-symbols:shopping-bag-outline",class:"mr-1 text-base"}),$(" 进入市场选购您的商品 ")])])),i("div",Le,[e(p).model===4?(n(),u("div",Pe,[l(e(h),{icon:"material-symbols:account-balance-wallet-outline",class:"ml-2 mr-2 text-base"}),$("对话额度： "+N(`${e(y).sumModel4Count||0} 次`),1)])):v("",!0),e(p).model===3?(n(),u("div",Ue,[l(e(h),{icon:"material-symbols:account-balance-wallet-outline",class:"ml-2 mr-2 text-base"}),$("对话额度： "+N(`${e(y).sumModel3Count||0} 次`),1)])):v("",!0),e(p).model===4?(n(),u("div",je,[l(e(h),{icon:"ic:twotone-hourglass-top",class:"ml-2 mr-2 text-base"}),$("我已使用： "),l(e(F),{ref_key:"model4AnimationInstRef",ref:k,from:M.value,to:T.value},null,8,["from","to"]),$(" Token ")])):v("",!0),e(p).model===3?(n(),u("div",Ee,[l(e(h),{icon:"ic:twotone-hourglass-top",class:"ml-2 mr-2 text-base"}),$(" 我已使用： "),l(e(F),{ref_key:"model3AnimationInstRef",ref:_,from:b.value,to:G.value},null,8,["from","to"]),$(" Token ")])):v("",!0),i("div",Re,[l(e(L),{type:"tertiary",size:"small",onClick:x[2]||(x[2]=I=>e(p).updateNoticeDialog(!0))},{default:A(()=>[l(e(h),{icon:"mdi:notice-board",class:"ml-2 mr-2 text-sm"}),Oe]),_:1}),l(e(L),{type:"tertiary",size:"small",onClick:E},{default:A(()=>[l(e(h),{icon:"ri:emoji-sticker-line",class:"ml-2 mr-2 text-sm"}),qe]),_:1})]),i("div",Ke,[l(e(L),{type:"tertiary",size:"small",style:{width:"100%"},onClick:q},{default:A(()=>[l(e(h),{icon:"ant-design:delete-outlined",class:"ml-2 mr-2 text-sm"}),Ve]),_:1})])])])],4)]),_:1},8,["collapsed","show-trigger","style"]),e(o)?ue((n(),u("div",{key:0,class:"fixed inset-0 z-40 bg-black/40",onClick:K},null,512)),[[de,!e(c)]]):v("",!0)]))}});export{Qe as _};
