import{d as V,o as p,c as v,a as o,u as oe,g as ne,b as le,r as n,e as C,w as B,f as ae,h as ie,i as h,j as a,k as R,n as $,F as re,l as ce,m as ue,N as de,p as he,T as pe,t as U,q as ve,s as fe,_ as me,v as _e}from"./index-12f140ef.js";import{c as we}from"./index-c94da121.js";import{N as xe}from"./Slider-917869ef.js";const ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ye=o("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),be=[ye],ke=V({name:"FlashOutline",render:function(d,r){return p(),v("svg",ge,be)}});function Ce(I,d){let r,f;return function(..._){f=_,r||(r=setTimeout(()=>{I.apply(this,f),r=null},d))}}const $e={class:"bg-[#E7ECF6] h-[100vh] overflow-hidden h-full p-4 pr-0 dark:bg-[#18181c] flex flex-col"},Ie={class:"p-4 flex pr-6 justify-between items-center"},Le=o("div",{class:"font-bold text-xl"},"AI绘画广场",-1),Ee={class:"w-[200px] sm:w-[300px] flex justify-between"},Ne=o("span",{class:"hidden sm:block"},"尺寸调整",-1),Me={class:"flex-1 ml-5"},Te={class:"px-4 mb-6 pr-5"},je={class:"market overflow-y-scroll flex-1 min-h-screen bg-[#E7ECF6] p-4 dark:bg-[#18181c] relative"},ze=["id"],He=["id","src","onLoad","onError","onClick"],Ae={class:"menu p-2 text-[#cbd5e1]"},Fe={class:"prompt"},Se={class:"flex justify-between items-end"},We=["onClick"],Be={class:"text-sm dark:text-slate-400"},De=V({__name:"index",setup(I){var A;const d=oe(),r=(A=ne())==null?void 0:A.appContext.config.globalProperties.$viewerApi,f=le(),m=n([]),_=n({}),N=n(0),i=n(160),c=n(0),w=n(10),D=n(10),L=n([]),E=n(null),M=n(0),O=C(()=>d.isLogin),x=n(30),g=n(""),T=C(()=>x.value+w.value+150);function y(){q(),J();const s=c.value,t=i.value,e=[];b.value.forEach((u,l)=>{const{width:Z,height:ee}=u.fileInfo,te=t/Z,F=ee*te+D.value+N.value,k=_.value[u.id];if(e.length<s)k.style.top="0px",k.style.left=`${(t+w.value)*l}px`,e.push(F);else{const S=Math.min.apply(null,e),W=e.findIndex(se=>se===S);k.style.top=`${S+0}px`,k.style.left=`${W*(i.value+w.value)}px`,e[W]+=F}}),M.value=Math.max(...e)+130}function P(s,t){s&&t&&(_.value[t.id]=s)}function q(){const{showName:s=0,showOther:t=0}={};N.value=[s,t].filter(e=>e).length*15}const b=C(()=>g.value?m.value.filter(s=>{const{prompt:t}=s;return t.includes(g.value)}):m.value);B(x,()=>{y()});let j=null;B(b,()=>{b.value.length&&(clearTimeout(j),j=setTimeout(()=>{y()},300))});async function G(){const s=await ue({size:999,rec:1});m.value=s.data.rows}function J(){if(!E.value)return;const s=E.value.clientWidth;c.value=Math.floor(s/T.value);const t=s-c.value*T.value,e=(c.value-1)*w.value;t-e<0&&(c.value-=1),i.value=Math.floor((s-e)/c.value)}function K(s,t){L.value.push(t.id)}function Q(s,t){L.value.push(t.id)}function X(s){if(!O.value)return d.setLoginDialog(!0);const{prompt:t}=s;we({text:t}),f.success("复制prompt成功")}function Y(s){const{fileInfo:t}=s,{cosUrl:e}=t;r({options:{},images:[e]})}const z=C(()=>s=>{const{fileInfo:t}=s,{width:e,height:u}=t;return u/(e/i.value)}),H=Ce(function(){y()},200);return ae(async()=>{await G(),y(),window.addEventListener("resize",H)}),ie(()=>{window.removeEventListener("resize",H)}),(s,t)=>(p(),v("div",$e,[o("div",Ie,[Le,o("div",Ee,[Ne,o("div",Me,[h(a(xe),{value:x.value,"onUpdate:value":t[0]||(t[0]=e=>x.value=e),step:10},null,8,["value"])])])]),o("div",Te,[h(a(he),{value:g.value,"onUpdate:value":t[1]||(t[1]=e=>g.value=e),placeholder:"prompt关键词搜索"},{prefix:R(()=>[h(a(de),{component:a(ke)},null,8,["component"])]),_:1},8,["value"])]),o("div",je,[o("div",{id:"wapper",ref_key:"wapperRef",ref:E,class:"wapper",style:$({height:`${M.value}px`})},[(p(!0),v(re,null,ce(a(b),(e,u)=>(p(),v("div",{id:e.id,key:u,ref_for:!0,ref:l=>P(l,e),class:"wapper-item",style:$({width:`${i.value}px`})},[h(pe,{name:"img",css:!0},{default:R(()=>[o("img",{id:e.id,class:"item-file rounded-sm",style:$({width:`${i.value}px`,height:`${a(z)(e)}px`}),src:e.fileInfo.thumbImg,loading:"lazy",onLoad:l=>K(l,e),onError:l=>Q(l,e),onClick:l=>Y(e)},null,44,He)]),_:2},1024),o("div",Ae,[o("div",Fe,U(e.fullPrompt),1),o("div",Se,[ve(U(e.createdAt)+" ",1),o("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:fe(l=>X(e),["stop"])},[o("span",Be,[h(a(me),{icon:"tabler:copy",class:"text-sm"})])],8,We)])]),L.value.includes(e.id)?_e("",!0):(p(),v("div",{key:0,class:"item-loading",style:$({width:`${i.value}px`,height:`${a(z)(e)}px`})},null,4))],12,ze))),128))],4)])]))}});export{De as default};
